#pragma once
#include "Object3d.h"
#include "Controller.h"
#include "Keyboard.h"
#include "Easing.h"
#include "Collision.h"
#include "Operator.h"
#include "SafeDelete.h"

class Rope
{
private:
	Rope();

	~Rope();

public:
	// コピーコンストラクタを無効化
	Rope(const Rope& obj) = delete;
	// 代入演算子を無効化
	Rope& operator=(const Rope& obj) = delete;
public: // メンバ関数

	static Rope* GetInstance();

	bool Initialize();

	void Update(const XMFLOAT3& startPos, const XMFLOAT3& endPos);

	void Draw();

	float GetLength(XMFLOAT3 posA, XMFLOAT3 posB)
	{
		XMFLOAT3 len = { posA.x - posB.x, posA.y - posB.y, posA.z - posB.z };
		return sqrtf(len.x * len.x + len.y * len.y + len.z * len.z);
	}

private: // メンバ変数
	//ロープモデル
	Model* ropeModel = nullptr;
	Object3d* ropeObj = nullptr;

	// 変数
	XMFLOAT3 rPos = {};
	XMFLOAT3 rScale = {};
	XMFLOAT3 rRot = {};
	XMFLOAT3 manageRopePos = {}; // ロープ位置管理用
	XMFLOAT3 manageRopeScale = { 0.0f, 0.0f, 0.0f }; // ロープスケール管理用
	const float maxRope = 15.0f; // ロープの最大
	float angleX = 0.0f; // X軸
	float angleY = 0.0f; // Y軸
	float vecXZ = 0.0f; // XZ平面上のベクトル
	float objLength = 0.0f;
	bool rFlag = false; // 接触フラグ
	bool rThrowFlag = false; // ロープを飛ばす
	// ターゲットする距離の基準
	const float baseLength = 15.0f;

	XMFLOAT3 tPos = {};
	float tLength = 0.0f;

	// 突進用
	XMFLOAT3 startPos = {}; // 開始位置
	XMFLOAT3 endPos = {}; // 終点位置
	float avoidTime = 0.0f; // 経過時間
	bool pEaseFlag = false;
	bool eEaseFlag = false;
};

